

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Neuroimaging Computing Resources &mdash; TAMU MRI Resources 1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Converting Raw Data" href="conversion.html" />
    <link rel="prev" title="Scanning at TIPS" href="scanning.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> TAMU MRI Resources
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="irb.html">MRI Study IRB Procedures</a></li>
<li class="toctree-l1"><a class="reference internal" href="scanning.html">Scanning at TIPS</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Neuroimaging Computing Resources</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#data-storage-server">Data Storage Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-a-computing-cluster">Using a computing cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="#brazos-computing-cluster">Brazos Computing Cluster</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#connecting-to-brazos">Connecting to Brazos</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#virtual-gl-turbovnc-graphical-connection">Virtual GL &amp; TurboVNC Graphical Connection</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#loading-software-resources">Loading software resources</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#running-containerized-jobs">Running containerized jobs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#submitting-jobs">Submitting jobs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#submitting-container-jobs-to-slurm">submitting container jobs to slurm</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#terra-supercomputer">Terra Supercomputer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#remote-visualization">Remote Visualization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="conversion.html">Converting Raw Data</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">TAMU MRI Resources</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Neuroimaging Computing Resources</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/computing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="neuroimaging-computing-resources">
<h1>Neuroimaging Computing Resources<a class="headerlink" href="#neuroimaging-computing-resources" title="Permalink to this headline">¶</a></h1>
<p>This page gives an overview of the resources available for neuroimaging computing and date storage.</p>
<div class="section" id="data-storage-server">
<h2>Data Storage Server<a class="headerlink" href="#data-storage-server" title="Permalink to this headline">¶</a></h2>
<p>Once a scan is completed, it is transferred to the Department’s storage server (see your PI or Hugh McCann for access). This server had to be mounted on your local computer. Once the server is mounted on your computer you can transfer the files to your local workstations or to a computing cluster. Both brazos and terra are accessible through globus. You must install globus on your local computer and set it up as an endpoint. As part of the set-up, you must add access to mounted drives (e.g., the storage share or GoogleDrive), as shown <a class="reference external" href="https://docs.globus.org/how-to/globus-connect-personal-mac/">in these instructions</a>.</p>
<p><a class="reference external" href="http://www.brazos.tamu.edu/docs/globusonline.html/">Brazos Globus Instructions</a></p>
<p><a class="reference external" href="https://hprc.tamu.edu/wiki/SW:GlobusConnect">Terra Globus Instructions</a></p>
</div>
<div class="section" id="using-a-computing-cluster">
<h2>Using a computing cluster<a class="headerlink" href="#using-a-computing-cluster" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://campuscluster.illinois.edu/user_info/doc/beginner.html">https://campuscluster.illinois.edu/user_info/doc/beginner.html</a></p>
</div>
<div class="section" id="brazos-computing-cluster">
<h2>Brazos Computing Cluster<a class="headerlink" href="#brazos-computing-cluster" title="Permalink to this headline">¶</a></h2>
<p>Brazos is a high-throughput computing cluster maintained by the College of Science. The cluster is primarily available to stakeholders. PBSI has a stake in brazos which includes priority access to 128 computing cores. The remainder of the free computing cores are available via the background queue.</p>
<div class="section" id="connecting-to-brazos">
<h3>Connecting to Brazos<a class="headerlink" href="#connecting-to-brazos" title="Permalink to this headline">¶</a></h3>
<p>Brazos is accessible to approved users via <code class="docutils literal notranslate"><span class="pre">ssh</span></code>. See also <a class="reference external" href="http://www.brazos.tamu.edu/docs/login.html/">login information</a>.</p>
<p>On a windows machine you can connect with <a class="reference external" href="https://www.putty.org/">putty</a> or <a class="reference external" href="https://mobaxterm.mobatek.net/">MobaXterm</a>. On a mac, simply use the built-in terminal (I recommend installing the iTerm2 terminal instead of using the built-in terminal).</p>
<p>If you only need occasional graphics, you should be fine by enabling X-forwarding with the -Y flag in your ssh command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="o">-</span><span class="n">Y</span> <span class="o">&lt;</span><span class="n">userid</span><span class="o">&gt;</span><span class="nd">@login</span><span class="o">.</span><span class="n">brazos</span><span class="o">.</span><span class="n">tamu</span><span class="o">.</span><span class="n">edu</span>
</pre></div>
</div>
<p>If you are viewing images or using a graphics intensive GUI (e.g., conn), you will need to connect using Virtual GL (see below) or use <a class="reference external" href="http://www.brazos.tamu.edu/docs/graphical_login.html">X2Go Remote Desktop</a>. I have found that VirtualGL is faster, but novices to linux environments may be more comfortable using the X2Go Remote Desktop.</p>
<div class="section" id="virtual-gl-turbovnc-graphical-connection">
<h4>Virtual GL &amp; TurboVNC Graphical Connection<a class="headerlink" href="#virtual-gl-turbovnc-graphical-connection" title="Permalink to this headline">¶</a></h4>
<p>For a Virtual GL with TurboVNC graphical connection, follow the following steps:</p>
<p>1. Download and install <a class="reference external" href="https://sourceforge.net/projects/virtualgl/files/">VirtualGL</a> as well as <a class="reference external" href="https://sourceforge.net/projects/turbovnc/files/">TurboVNC</a>.</p>
<ol class="arabic" start="2">
<li><p class="first">Open terminal on local computer and ssh to gfx.brazos.tamu.edu. You can check if you already have a running vncserver with the command <code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">axu</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">vnc</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">\($USER)\</span></code>. If you don’t already have a running server, start a VNC server session using the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vncserver</span>
</pre></div>
</div>
</li>
</ol>
<p>You will be prompted to set (and confirm) a password. If it was successful, you will obtain something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>You need to make a note of the display number, e.g., login:1, as this is your individual display. You will next need to ssh while opening a tunnel to the VNC display port, which is determined by added the display number to `5900`, e.g., `1 + 5900 = 5901`. You should now exit to close your ssh connection.
</pre></div>
</div>
<ol class="arabic" start="3">
<li><p class="first">In your local computer terminal, you need to create an ssh tunnel for encrypting the VNC stream by typing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="o">-</span><span class="n">L</span> <span class="o">&lt;</span><span class="n">vncport</span><span class="o">&gt;</span><span class="p">:</span><span class="n">localhost</span><span class="p">:</span><span class="o">&lt;</span><span class="n">vncport</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">netid</span><span class="o">&gt;</span><span class="nd">@gfx</span><span class="o">.</span><span class="n">brazos</span><span class="o">.</span><span class="n">tamu</span><span class="o">.</span><span class="n">edu</span>
</pre></div>
</div>
</li>
</ol>
<p>where &lt;vncport&gt; is your VNC display port determined in the previous step, e.g., 5901.</p>
<ol class="arabic" start="4">
<li><p class="first">You can now open TurboVNC Viewer on your local machine and enter the vncserver as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">localhost</span><span class="p">:</span><span class="o">&lt;</span><span class="n">vncport</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">This will open a remote desktop on brazos. You can then start your graphics program with the <cite>vglrun command</cite>, e.g.,:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vglrun</span> <span class="n">matlab</span> <span class="o">-</span><span class="n">nosoftwareopengl</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="loading-software-resources">
<h3>Loading software resources<a class="headerlink" href="#loading-software-resources" title="Permalink to this headline">¶</a></h3>
<p>Software on brazos is managed with the <code class="docutils literal notranslate"><span class="pre">modules</span></code> system. To see what software is available on brazos, use <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">avail</span></code>. Psychology software is available after first loading the <cite>psyc</cite> module
:: module load psyc
You can then use <code class="docutils literal notranslate"><span class="pre">module</span> <span class="pre">avail</span></code> to see which software packages, and which versions, are available. If you don’t specify a version, he most recent version is loaded by default.</p>
<p>To load a specific version you need to give the version number, e.g.,
:: module load fsl/5.0.10</p>
<p>By loading a module you are configuring paths and loading any dependent software. Once you load a software module, the executables should be available, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ which fsl
        /usr/bin/which: no fsl in (/home/joseph.orr/bin:/usr/lib64/qt-3.3/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/usr/local/bin/brazos)
$ module load psyc
$ module load fsl
$ which fsl
        /apps/psyc/fsl/5.0.11/bin/fsl
</pre></div>
</div>
<div class="section" id="running-containerized-jobs">
<h4>Running containerized jobs<a class="headerlink" href="#running-containerized-jobs" title="Permalink to this headline">¶</a></h4>
<p>There is a growing trend in software to use <em>containers</em>, which are “lightweight, standalone, executable package of software that includes everything needed to run an application: code, runtime, system tools, system libraries and settings.” Containers are useful for running software that require lots of library dependencies that might lead to compatability issues with software already on a system. <strong>Docker</strong> is a leader in the field of container packaging, and there are already several docker container images available for neuroimaging software, e.g., <code class="docutils literal notranslate"><span class="pre">fmriprep</span></code> and <code class="docutils literal notranslate"><span class="pre">mriqc</span></code>. However, docker containers have issues with security on HPC systems, but there is a workaround called <code class="docutils literal notranslate"><span class="pre">singularity</span></code>. <code class="docutils literal notranslate"><span class="pre">singularity</span></code> is available on <code class="docutils literal notranslate"><span class="pre">brazos</span></code> for running container images. Currently, the following containers are available on <code class="docutils literal notranslate"><span class="pre">brazos</span></code>:</p>
<ul class="simple">
<li>fmriprep (fMRI Pre-processing pipeline)</li>
<li>bidskit (dicom to bids conversion)</li>
<li>heudiconv (dicom to bids conversion)</li>
<li>mriqc (mri quality control)</li>
<li>afni (fMRI Processing toolbox)</li>
<li>bidsvalidator (tool for validating bids specification dataset)</li>
<li>ciftify (tool for converting non-HCP dataset to cifti format–combined file with cortical surface and subcortical volumes–so HCP Pipeline tools can be used)</li>
</ul>
<p>A lot of MRI software is available as a container through <a class="reference external" href="https://github.com/kaczmarj/neurodocker">neurodocker</a>.</p>
<p>Contact <a class="reference external" href="mailto:joseph&#46;orr&#37;&#52;&#48;tamu&#46;edu">joseph<span>&#46;</span>orr<span>&#64;</span>tamu<span>&#46;</span>edu</a> for adding new container images to brazos. Your container image will be placed in <code class="docutils literal notranslate"><span class="pre">/apps/psyc/containers</span></code></p>
</div>
<div class="section" id="submitting-jobs">
<h4>Submitting jobs<a class="headerlink" href="#submitting-jobs" title="Permalink to this headline">¶</a></h4>
<p>When you login to the cluster, you are on on the login node, which is only meant for simple processes like editing text files or copying a small number of files. More complicated jobs should be submitted to the compute nodes with the job manager.</p>
<p>Brazos (as well as terra) use <code class="docutils literal notranslate"><span class="pre">slurm</span></code> for managing jobs, an open source package which is used on most academic computing clusters. Brazos has a good guide to <a class="reference external" href="http://www.brazos.tamu.edu/docs/slurm.html">slurm</a>. A job is submitted with <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> and monitored with <code class="docutils literal notranslate"><span class="pre">squeue</span></code>. If you need to actively monitor or interface with a job, you can start an interactive job with the wrapper <code class="docutils literal notranslate"><span class="pre">sintr</span></code>. This will queue the resources needed on a compute node.</p>
<p>FSL has a built in program for submitting jobs to slurm called <code class="docutils literal notranslate"><span class="pre">fsl_sub</span></code> that actually uses <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> to submit your job to slurm. However, many packages will self-submit so you won’t need to use <code class="docutils literal notranslate"><span class="pre">fsl_sub</span></code>. A list of the self-submitting programs is found <a class="reference external" href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/SGE%20submission%20FAQ">here</a>, and includes <code class="docutils literal notranslate"><span class="pre">feat</span></code>. Because many of these self-submitting jobs do some organizational procedures on the login node before submitting, you may need to call them from a interactive node.</p>
</div>
<div class="section" id="submitting-container-jobs-to-slurm">
<h4>submitting container jobs to slurm<a class="headerlink" href="#submitting-container-jobs-to-slurm" title="Permalink to this headline">¶</a></h4>
<p>To submit a container job to slurm, you must create a submission script as discucced above (Brazos&gt;Submitting jobs). The submission script will call singularity as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">singularity</span> <span class="n">run</span> <span class="o">&lt;</span><span class="n">container</span><span class="o">&gt;.</span><span class="n">simg</span> <span class="o">&lt;</span><span class="n">container</span> <span class="n">commands</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>AFNI (and possibly other containers) can be run interactively, meaning you can pull up the typical GUI and work with that. To do this however, you will need to run the container as an interactive job so that it isn’t running on the login node. You will need to make a slurm submission script, but instead of calling it with <code class="docutils literal notranslate"><span class="pre">sbatch</span></code> you can use <code class="docutils literal notranslate"><span class="pre">srun</span></code> instead. In your submission script you will need to specify the required walltime, RAM, nCPUS, etc.</p>
</div>
</div>
</div>
<div class="section" id="terra-supercomputer">
<h2>Terra Supercomputer<a class="headerlink" href="#terra-supercomputer" title="Permalink to this headline">¶</a></h2>
<p>The <cite>terra</cite> machine is the newest cluster available to members of TAMU through the High Performance Research Computing (HPRC) Center. Unlike <cite>brazos</cite>, <cite>terra</cite> is considered a <cite>high-performance</cite> cluster as opposed to a <cite>high-throughput</cite> cluster, meaning that it is optimized for highly parallel operations. The compute nodes generally have much less RAM that the compute nodes on brazos nodes. However, terra has many more cores than blanca, so if you are running large-scale analyses, terra may be more useful than brazos. Terra also has a good number of GPU nodes for running CUDA-capable jobs, e.g., diffusion preprocessing.</p>
<p><a class="reference external" href="https://hprc.tamu.edu/wiki/Terra">terra user guide</a>. The only fMRI software currently installed on terra is FSL v. 5.0.10, but you can request the installation of other software by <a class="reference external" href="mailto:help&#37;&#52;&#48;hprc&#46;tamu&#46;edu">emailing the HPRC Help</a>.</p>
<div class="section" id="remote-visualization">
<h3>Remote Visualization<a class="headerlink" href="#remote-visualization" title="Permalink to this headline">¶</a></h3>
<p>The HPRC Wiki has a great page on <a class="reference external" href="https://hprc.tamu.edu/wiki/Terra:Remote-Viz">remote visualization</a>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="conversion.html" class="btn btn-neutral float-right" title="Converting Raw Data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="scanning.html" class="btn btn-neutral float-left" title="Scanning at TIPS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Joseph M. Orr

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>